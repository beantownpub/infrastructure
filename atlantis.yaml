version: 3
projects:
- dir: dev
  name: dev
  workspace: dev
  autoplan:
    enabled: true
    when_modified: ["**/*.tf*"]
  workflow: wtf
- dir: prod
  name: prod
  workspace: jal-prod
  autoplan:
    enabled: true
    when_modified: ["**/*.tf*"]
  workflow: wtf

workflows:
  wtf:
    plan:
      steps:
      - init
      - env:
          name: TF_WORKSPACE
          value:
          # command: echo 'dev'
      - init
      - run: |
          unset TF_WORKSPACE
          terraform workspace select dev -no-color
      - plan
